# OWASP Juice Shop

**Tested By:** Abdelrahman Zaki

**Tested Conducted:** 04/05/2025

**Client:** OWASP

---
## Scope

- `http://ubuntu-server:8002`
	- All paths in scope.

---
## Enumeration

- Base Application is Angular
- Routing is handled by `hashRouter`

- Found those URLs outside of angular using `feroxbuster` tool
	```
	http://ubuntu-server:8002/profile
	http://ubuntu-server:8002/ftp
	http://ubuntu-server:8002/assets
	http://ubuntu-server:8002/redirect
	http://ubuntu-server:8002/video
	http://ubuntu-server:8002/api
	http://ubuntu-server:8002/Video
	http://ubuntu-server:8002/restaurants
	http://ubuntu-server:8002/assets/public/images/JuiceShop_Logo.png
	http://ubuntu-server:8002/assets/public/favicon_js.ico
	http://ubuntu-server:8002/promotion
	http://ubuntu-server:8002/Profile
	http://ubuntu-server:8002/VIDEO
	```

- Potential redirect on `/redirect?to=`

	![Pasted image 20250504193701](attachments/Pasted%20image%2020250504193701.png)

- Angular Paths
	```
	└──╼ $grep "path:" paths.js | tr -s " " | cut -d " " -f 3
	"administration",
	"accounting",
	"about",
	"address/select",
	"address/saved",
	"address/create",
	"address/edit/:addressId",
	"delivery-method",
	"deluxe-membership",
	"saved-payment-methods",
	"basket",
	"order-completion/:id",
	"contact",
	"photo-wall",
	"complain",
	"chatbot",
	"order-summary",
	"order-history",
	"payment/:entity",
	"wallet",
	"login",
	"forgot-password",
	"recycle",
	"register",
	"search",
	"hacking-instructor",
	"score-board",
	"track-result",
	"track-result/new",
	"2fa/enter",
	"privacy-security",
	"privacy-policy",
	"change-password",
	"two-factor-authentication",
	"data-export",
	"last-login-ip",
	"juicy-nft",
	"wallet-web3",
	"web3-sandbox",
	"bee-haven",
	"403",
	"**",
	```

--- 
##  Exploitation
### `/ftp`
- Information Leakage: Confidential document
- Filter bypass: `package.json.bak`
	- Null byte poisoning
	
	![Pasted image 20250504223313](attachments/Pasted%20image%2020250504223313.png)
### `/profile`

### `/metrics`
- Leaking server statistics

	![Pasted image 20250504230314](attachments/Pasted%20image%2020250504230314.png)
### `/rest/user/login`
- Auth bypass via SQLI
	- `' or 1=1; -- `
### `/api/users`
- Privilege Escalation via POST:
	- Provide `"role": "admin",`in the request body
	
	![Pasted image 20250505004655](attachments/Pasted%20image%2020250505004655.png) 
### `/#/search?q=`
- Reflected XSS
	![Pasted image 20250505191032](attachments/Pasted%20image%2020250505191032.png)
- No `httpOnly` on `token` cookie
	- steal/hijack login session and login in victims accounts

### `/rest/products/search?q=`
- SQL Injection
	![Pasted image 20250505194330](attachments/Pasted%20image%2020250505194330.png)

	- Password cracked for admin
		![Pasted image 20250505201650](attachments/Pasted%20image%2020250505201650.png)
		![Pasted image 20250505201815](attachments/Pasted%20image%2020250505201815.png) 
### `/rest/basket/:id`
- IDOR
	- Users can access other users' baskets
		![Pasted image 20250505203747](attachments/Pasted%20image%2020250505203747.png)
### `/api/BasketItems`
- HTTP Parameter Pollution: POST request
	![Pasted image 20250505204646](attachments/Pasted%20image%2020250505204646.png)

	![Pasted image 20250505204711](attachments/Pasted%20image%2020250505204711.png) 
### `/api/BasketItems/:id`
- Abuse of functionality
	- Send a negative quantity resulting in:
		- The cart total was negative.
		- User wallet balance increased.
		- Items could be “purchased” for free.
		![Pasted image 20250505205319](attachments/Pasted%20image%2020250505205319.png)
		![Pasted image 20250505210914](attachments/Pasted%20image%2020250505210914.png)
		![Pasted image 20250505211042](attachments/Pasted%20image%2020250505211042.png)

### `/api/Feedbacks/`
- 0 Star review
- Captchas doesn't prevent replays
- Can send review as another user by modifying the `UserId` param
	```json
	{  
	  "UserId" : 2,  
	  "captchaId" : 6,  
	  "captcha" : "19",  
	  "comment" : "test comment (***in@juice-sh.op)",  
	  "rating" : "-1"  
	}
	```
	![Pasted image 20250506171518](attachments/Pasted%20image%2020250506171518.png) 
### `/file-upload`
- XXE
	![Pasted image 20250506172845](attachments/Pasted%20image%2020250506172845.png)

### `/#/privacy-security/last-login-ip`
- Stored XSS via `True-Client-IP` header poisoning

### `/api/Products`
- Modify products via `PUT` as normal user
- Create new products with `POST`

### `/rest/products/reviews`
- NoSQL Injection

### `/#/contact`
- Stored XSS in admin

### `/profile`
- Stored XSS/CSP Bypass
	> Don't forget to add more details of how did you bypass it.
- SSTI
	- Could be escalated to RCE via revershell via Pug SSTI 