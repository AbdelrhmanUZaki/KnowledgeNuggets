# Legacy Code

#### Analyzing `package.json` for Vulnerabilities

- The `package.json` file was previously downloaded, and it lists all dependencies with their respective versions.
    
- Each package version should be reviewed for known vulnerabilities. This can be done using tools like **[Snyk](https://snyk.io/)**.
    
    - **Example Vulnerability**:
        
        - `sanitize-html` version `1.4.2` is vulnerable to XSS.
	        - References:
		        - [Cross-site Scripting (XSS) in sanitize-html | Snyk](https://security.snyk.io/vuln/npm:sanitize-html:20160801)
		        - [Sanitization not applied recursively · Issue #29 · apostrophecms/sanitize-html](https://github.com/apostrophecms/sanitize-html/issues/29)
            
        - A reliable source and proof-of-concept (PoC) should be shared with the client for each vulnerability discovered.
            

#### XSS and CSP Behavior

- Attempted **XSS Payload** in the username field:
    
    ```html
    <<s|sscript>alert('xss')</script>
    ```
    
    - This payload was **blocked by the Content Security Policy (CSP)**.
        
- **Details from Browser Logs**:
    
    - Logs show errors such as:
        
        ```
        Refused to execute inline script because it violates the following Content Security Policy directive: "script-src 'self'"
        ```
        
    - This indicates that **inline scripts are not allowed** due to the `script-src 'self'` directive.
        
- **Observation on `img-src`**:
    
    - CSP allows external images (e.g., hosted on the internet).
        
    - Providing an external image URL successfully embeds the image.
        
- **CSP Bypass Attempt via Image URL Manipulation**:
    
    - Payload example (malicious CSP injection):
        
        ```
        https://x.jpg; script-src 'unsafe-inline' 'self' 'unsafe-eval' http://ajax.googleapis.com ...
        ```
		- Note: write a full working CSP Policy instead of the above example in your real test
		
    - This tricks the application into **modifying its CSP policy**, enabling older XSS payloads to execute.
        
#### SSTI via PUG Template Injection

- Manually injecting `%0a` into the username field using **ZAP** causes the app to crash, requiring a Docker container restart.
    
- The displayed error logs reveal usage of **PUG templates**.
    
- **SSTI Payload**:
    
    ```pug
    #{1+1}
    ```
    
    - Injecting this into the username field results in **Server-Side Template Injection**, evaluating the expression.
        
    - Reference: [SSTI in HackTricks](https://hacktricks.boitatech.com.br/pentesting-web/ssti-server-side-template-injection)
        
#### Instructor Note: Reverse Shell Exploitation (Errata)

- The latest **Juice Shop Docker image** appears to prevent reverse shell exploitation via previously known methods.
    
- However, exploitation is still possible via:
    - Generating a payload with **`msfvenom`**
    - Transferring it using tools like `wget` or `curl`
    - Changing file permissions and executing the payload on the target